<article id="turn">
    <h3></h3>
    <table id="map" class="ctrl-combatMap">
    </table>
</article>
<script type="application/javascript">
loadExternalScript("public/combatMap.js");
</script>
<script id="template-combatCell" type="text/html">
<td class="ctrl-combatCell">
    <button>&nbsp;</button>
</td>
</script>
<script type="application/javascript">
(function combatScript() {
    var onMessageReceived, template,
        TABLE_WIDTH = 10,
        TABLE_HEIGHT = 10
    ;
    
    template = document.querySelector("#template-combatCell").innerHTML;

    /**
     * Handles messages received through the web socket.
     */
    onReceiveMessage = function(event) {
        var data, el;
        data = JSON.parse(event.data);
        if (data["map_changed"]) {
            pageContext.renderMap(data["map_changed"], template);    
        }
    }; 
    
    wait(function() {
        if (pageContext.renderMap) {
            pageContext.renderMap({
                height: TABLE_HEIGHT,
                width: TABLE_WIDTH
            }, template);
            return true;
        }
        return false;
    });
})();
</script>
